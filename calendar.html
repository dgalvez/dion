<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de eventos recurrentes</title>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/dragula@3.7.2/dist/dragula.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.4.0/build/ical.js"></script>
    <style>
        body {
            font-family: sans-serif;
        }
        #calendar-container {
            display: flex;
        }
        #calendar {
            width: 70%;
            margin: 20px;
        }
        #event-form {
            width: 30%;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<h1>Creador de eventos recurrentes</h1>
<button id="download-ics">Descargar .ics</button>

<div id="calendar-container">
    <div id="calendar"></div>

    <div id="event-form">
        <h2>Crear/Editar evento</h2>
        <form>
            <label for="event-name">Nombre:</label>
            <input type="text" id="event-name" name="event-name"><br><br>

            <label for="event-start">Fecha de inicio:</label>
            <input type="date" id="event-start" name="event-start"><br><br>

            <label for="event-end">Fecha de fin (recurrencia):</label>
            <input type="date" id="event-end" name="event-end"><br><br>

            <label for="event-interval">Intervalo (horas):</label>
            <input type="number" id="event-interval" name="event-interval" min="1"><br><br>

            <input type="button" value="Crear evento" id="create-event">
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            editable: true,
            eventDrop: function(info) {
                // Implementa la l贸gica para actualizar el evento
            },
            events: []
        });
        calendar.render();

        var createEventButton = document.getElementById('create-event');
        createEventButton.addEventListener('click', function() {
            var eventName = document.getElementById('event-name').value;
            var eventStart = document.getElementById('event-start').value;
            var eventEnd = document.getElementById('event-end').value;
            var eventInterval = document.getElementById('event-interval').value;

            var events = generarEventosRecurrentes(eventName, eventStart, eventEnd, eventInterval);
            calendar.addEventSource(events);
        });

        function generarEventosRecurrentes(nombre, inicio, fin, intervalo) {
            var eventos = [];
            var fechaActual = new Date(inicio);
            var fechaFin = new Date(fin);

            while (fechaActual <= fechaFin) {
                eventos.push({
                    title: nombre,
                    start: fechaActual.toISOString(),
                });
                fechaActual.setHours(fechaActual.getHours() + parseInt(intervalo));
            }
            return eventos;
        }

        var downloadICSButton = document.getElementById('download-ics');
        downloadICSButton.addEventListener('click', function() {
            // Implementa la l贸gica para descargar el archivo .ics
        });

        var downloadICSButton = document.getElementById('download-ics');
        downloadICSButton.addEventListener('click', function() {
            const ical = new ICAL.Component('vcalendar');
            ical.addPropertyWithValue('prodid', '-//Tu sitio web//Creador de eventos//EN');

            // Obtener los eventos del calendario
            var events = calendar.getEvents();

            events.forEach(function(event) {
                var vevent = new ICAL.Component('vevent');
                vevent.addPropertyWithValue('summary', event.title);
                vevent.addPropertyWithValue('dtstart', ICAL.Time.fromJSDate(event.start));
                // Agrega otras propiedades del evento si es necesario (descripci贸n, ubicaci贸n, etc.)

                // Agrega la regla de recurrencia si existe
                if (event.rrule) {
                    var rrule = new ICAL.Recur(event.rrule);
                    vevent.addPropertyWithValue('rrule', rrule.toString());
                }
                ical.addSubcomponent(vevent);
            });

            // Generar el archivo .ics
            var icsContent = ical.toString();

            // Crear un enlace de descarga
            var downloadLink = document.createElement('a');
            downloadLink.href = 'data:text/calendar;charset=utf-8,' + encodeURIComponent(icsContent);
            downloadLink.download = 'eventos.ics';

            // Simular un clic en el enlace para iniciar la descarga
            downloadLink.click();
        });





        dragula([calendarEl]);
    });
</script>

</body>
</html>